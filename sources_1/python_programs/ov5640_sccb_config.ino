
// Include Wire Library for I2C
#include <Wire.h>


// Define Pins
const uint8_t SDA_PIN = 4;
const uint8_t SCL_PIN = 5;
const uint8_t OV5640_ADDR = 0x3C;

#include <Wire.h>

// Địa chỉ I2C của OV5640 (7-bit)
#define OV5640_ADDR 0x3C

// Cấu trúc lệnh ghi: Thanh ghi cao (8 bit), Thanh ghi thấp (8 bit), Giá trị (8 bit)
struct RegSetting {
    uint8_t reg_high;
    uint8_t reg_low;
    uint8_t val;
};

// Mảng cấu hình được lưu trong Flash (.rodata) để tiết kiệm RAM

// const RegSetting ov5640_vga_rgb565[] = {
//     // ======================================================
//     // 1. SYSTEM RESET & POWER UP
//     // ======================================================
//     {0x31, 0x03, 0x11}, // System clock from PLL, SCCB enable
//     {0x30, 0x08, 0x82}, // Software reset
//     {0x30, 0x08, 0x42}, // Software power down disable
//     {0x31, 0x03, 0x03}, // System clock settings
//     {0x30, 0x17, 0xff}, // I/O control
//     {0x30, 0x18, 0xff}, // I/O control
//     {0x30, 0x34, 0x1A}, // PLL Charge Pump
//     {0x30, 0x37, 0x13}, // PLL Divider
//     {0x31, 0x08, 0x01}, // System root divider

//     // ======================================================
//     // 2. ANALOG CONTROL
//     // ======================================================
//     {0x36, 0x30, 0x36},
//     {0x36, 0x31, 0x0e},
//     {0x36, 0x32, 0xe2},
//     {0x36, 0x33, 0x12},
//     {0x36, 0x21, 0xe0},

//     // ======================================================
//     // 3. SENSOR CONTROL
//     // ======================================================
//     {0x37, 0x04, 0xa0},
//     {0x37, 0x03, 0x5a},
//     {0x37, 0x15, 0x78},
//     {0x37, 0x17, 0x01},
//     {0x37, 0x0b, 0x60},
//     {0x37, 0x05, 0x1a},
//     {0x39, 0x05, 0x02},
//     {0x39, 0x06, 0x10},
//     {0x39, 0x01, 0x0a},
//     {0x37, 0x31, 0x12},

//     // ======================================================
//     // 4. VGA 640x480 @ 60Hz TIMING
//     // ======================================================
//     // PLL Settings
//     {0x30, 0x35, 0x11}, // PLL Sys Div
//     {0x30, 0x36, 0x54}, // PLL Multiplier (~x84)
//     {0x30, 0x37, 0x13}, // PLL Pre-div

//     // Output Size: X = 640 (0x0280)
//     {0x38, 0x08, 0x02}, // X output size high byte
//     {0x38, 0x09, 0x80}, // X output size low byte (0x80)

//     // Output Size: Y = 480 (0x01E0)
//     {0x38, 0x0a, 0x01}, // Y output size high byte
//     {0x38, 0x0b, 0xE0}, // Y output size low byte (0xE0)

//     // Timing Size (HTS & VTS) -> Controls FPS
//     {0x38, 0x0c, 0x07}, // HTS High
//     {0x38, 0x0d, 0x68}, // HTS Low
//     {0x38, 0x0e, 0x03}, // VTS High
//     {0x38, 0x0f, 0xd8}, // VTS Low

//     // ISP Scaling (Enable scaling to compress larger image to VGA)
//     {0x50, 0x01, 0xA3}, // ISP Control 01: Enable Scaling

//     // ======================================================
//     // 5. OUTPUT FORMAT (RGB565)
//     // ======================================================
//     {0x43, 0x00, 0x61}, // Format Control: RGB565, Order RGB
//     {0x50, 0x1f, 0x01}, // ISP Format: RGB

//     // ======================================================
//     // 6. ISP & TIMING OPTIONS
//     // ======================================================
//     {0x36, 0x00, 0x08},
//     {0x36, 0x01, 0x33},
//     {0x30, 0x2d, 0x60},
//     {0x36, 0x20, 0x52},
//     {0x37, 0x1b, 0x20},
//     {0x47, 0x1c, 0x50},

//     // ======================================================
//     // 7. AEC / AGC / AWB (Auto Exposure/Gain/White Balance)
//     // ======================================================
//     {0x3a, 0x13, 0x43}, // AEC
//     {0x3a, 0x18, 0x00}, // AEC Ceiling
//     {0x3a, 0x19, 0xf8}, // AEC Ceiling
//     {0x36, 0x35, 0x13},
//     {0x36, 0x36, 0x03},
//     {0x36, 0x34, 0x40},
//     {0x36, 0x22, 0x01},

//     // ======================================================
//     // 8. 50/60Hz DETECTION
//     // ======================================================
//     {0x3c, 0x01, 0x34},
//     {0x3c, 0x04, 0x28},
//     {0x3c, 0x05, 0x98},
//     {0x3c, 0x06, 0x00},
//     {0x3c, 0x07, 0x08},
//     {0x3c, 0x08, 0x00},
//     {0x3c, 0x09, 0x1c},
//     {0x3c, 0x0a, 0x9c},
//     {0x3c, 0x0b, 0x40},

//     // ======================================================
//     // 9. BLC & OTHER SETTINGS
//     // ======================================================
//     {0x38, 0x10, 0x00}, // H Offset
//     {0x38, 0x11, 0x10},
//     {0x38, 0x12, 0x00}, // V Offset
//     {0x37, 0x08, 0x64},
//     {0x40, 0x01, 0x02}, // BLC Enable
//     {0x40, 0x05, 0x1a},
//     {0x30, 0x00, 0x00},
//     {0x30, 0x04, 0xff},
//     {0x30, 0x0e, 0x58},
//     {0x30, 0x2e, 0x00},
//     {0x44, 0x0e, 0x00},
//     {0x50, 0x00, 0xa7},
//     {0x3a, 0x0f, 0x30},
//     {0x3a, 0x10, 0x28},
//     {0x3a, 0x1b, 0x30},
//     {0x3a, 0x1e, 0x26},
//     {0x3a, 0x11, 0x60},
//     {0x3a, 0x1f, 0x14},

//     // ======================================================
//     // 10. LENS CORRECTION
//     // ======================================================
//     {0x58, 0x00, 0x23},
//     {0x58, 0x01, 0x14},
//     {0x58, 0x02, 0x0f},
//     {0x58, 0x03, 0x0f},
//     {0x58, 0x04, 0x12},
//     {0x58, 0x05, 0x26},
//     {0x58, 0x06, 0x0c},
//     {0x58, 0x07, 0x08},
//     {0x58, 0x08, 0x05},
//     {0x58, 0x09, 0x05},
//     {0x58, 0x0a, 0x08},
//     {0x58, 0x0b, 0x0d},
//     {0x58, 0x0c, 0x08},
//     {0x58, 0x0d, 0x03},
//     {0x58, 0x0e, 0x00},
//     {0x58, 0x0f, 0x00},
//     {0x58, 0x10, 0x03},
//     {0x58, 0x11, 0x09},
//     {0x58, 0x12, 0x07},
//     {0x58, 0x13, 0x03},
//     {0x58, 0x14, 0x00},
//     {0x58, 0x15, 0x01},
//     {0x58, 0x16, 0x03},
//     {0x58, 0x17, 0x08},
//     {0x58, 0x18, 0x0d},
//     {0x58, 0x19, 0x08},
//     {0x58, 0x1a, 0x05},
//     {0x58, 0x1b, 0x06},
//     {0x58, 0x1c, 0x08},
//     {0x58, 0x1d, 0x0e},
//     {0x58, 0x1e, 0x29},
//     {0x58, 0x1f, 0x17},
//     {0x58, 0x20, 0x11},
//     {0x58, 0x21, 0x11},
//     {0x58, 0x22, 0x15},
//     {0x58, 0x23, 0x28},
//     {0x58, 0x24, 0x46},
//     {0x58, 0x25, 0x26},
//     {0x58, 0x26, 0x08},
//     {0x58, 0x27, 0x26},
//     {0x58, 0x28, 0x64},
//     {0x58, 0x29, 0x26},
//     {0x58, 0x2a, 0x24},
//     {0x58, 0x2b, 0x22},
//     {0x58, 0x2c, 0x24},
//     {0x58, 0x2d, 0x24},
//     {0x58, 0x2e, 0x06},
//     {0x58, 0x2f, 0x22},
//     {0x58, 0x30, 0x40},
//     {0x58, 0x31, 0x42},
//     {0x58, 0x32, 0x24},
//     {0x58, 0x33, 0x26},
//     {0x58, 0x34, 0x24},
//     {0x58, 0x35, 0x22},
//     {0x58, 0x36, 0x22},
//     {0x58, 0x37, 0x26},
//     {0x58, 0x38, 0x44},
//     {0x58, 0x39, 0x24},
//     {0x58, 0x3a, 0x26},
//     {0x58, 0x3b, 0x28},
//     {0x58, 0x3c, 0x42},
//     {0x58, 0x3d, 0xce},

//     // ======================================================
//     // 11. GAMMA CURVE
//     // ======================================================
//     {0x51, 0x80, 0xff},
//     {0x51, 0x81, 0x58},
//     {0x51, 0x82, 0x11},
//     {0x51, 0x83, 0x90},
//     {0x51, 0x84, 0x25},
//     {0x51, 0x85, 0x24},
//     {0x51, 0x86, 0x09},
//     {0x51, 0x87, 0x09},
//     {0x51, 0x88, 0x09},
//     {0x51, 0x89, 0x75},
//     {0x51, 0x8a, 0x54},
//     {0x51, 0x8b, 0xe0},
//     {0x51, 0x8c, 0xb2},
//     {0x51, 0x8d, 0x42},
//     {0x51, 0x8e, 0x3d},
//     {0x51, 0x8f, 0x56},
//     {0x51, 0x90, 0x46},
//     {0x51, 0x91, 0xff},
//     {0x51, 0x92, 0x00},
//     {0x51, 0x93, 0xf0},
//     {0x51, 0x94, 0xf0},
//     {0x51, 0x95, 0xf0},
//     {0x51, 0x96, 0x03},
//     {0x51, 0x97, 0x02},
//     {0x51, 0x98, 0x04},
//     {0x51, 0x99, 0x12},
//     {0x51, 0x9a, 0x04},
//     {0x51, 0x9b, 0x00},
//     {0x51, 0x9c, 0x06},
//     {0x51, 0x9d, 0x82},
//     {0x51, 0x9e, 0x00},

//     // ======================================================
//     // 12. COLOR MATRIX
//     // ======================================================
//     {0x54, 0x80, 0x01},
//     {0x54, 0x81, 0x08},
//     {0x54, 0x82, 0x14},
//     {0x54, 0x83, 0x28},
//     {0x54, 0x84, 0x51},
//     {0x54, 0x85, 0x65},
//     {0x54, 0x86, 0x71},
//     {0x54, 0x87, 0x7d},
//     {0x54, 0x88, 0x87},
//     {0x54, 0x89, 0x91},
//     {0x54, 0x8a, 0x9a},
//     {0x54, 0x8b, 0xaa},
//     {0x54, 0x8c, 0xb8},
//     {0x54, 0x8d, 0xcd},
//     {0x54, 0x8e, 0xdd},
//     {0x54, 0x8f, 0xea},
//     {0x54, 0x90, 0x1d},
//     {0x53, 0x81, 0x1e},
//     {0x53, 0x82, 0x5b},
//     {0x53, 0x83, 0x08},
//     {0x53, 0x84, 0x0a},
//     {0x53, 0x85, 0x7e},
//     {0x53, 0x86, 0x88},
//     {0x53, 0x87, 0x7c},
//     {0x53, 0x88, 0x6c},
//     {0x53, 0x89, 0x10},
//     {0x53, 0x8a, 0x01},
//     {0x53, 0x8b, 0x98},
//     {0x55, 0x80, 0x06},
//     {0x55, 0x83, 0x40},
//     {0x55, 0x84, 0x10},
//     {0x55, 0x89, 0x10},
//     {0x55, 0x8a, 0x00},
//     {0x55, 0x8b, 0xf8},

//     // ======================================================
//     // 13. OTHERS
//     // ======================================================
//     {0x50, 0x1d, 0x40},
//     {0x53, 0x00, 0x08},
//     {0x53, 0x01, 0x30},
//     {0x53, 0x02, 0x10},
//     {0x53, 0x03, 0x00},
//     {0x53, 0x04, 0x08},
//     {0x53, 0x05, 0x30},
//     {0x53, 0x06, 0x08},
//     {0x53, 0x07, 0x16},
//     {0x53, 0x09, 0x08},
//     {0x53, 0x0a, 0x30},
//     {0x53, 0x0b, 0x04},
//     {0x53, 0x0c, 0x06},
//     {0x50, 0x25, 0x00},
//     {0x30, 0x08, 0x02},
//     {0x30, 0x35, 0x11},
//     {0x30, 0x36, 0x69},
//     {0x3c, 0x07, 0x07},
//     {0x38, 0x20, 0x42},
//     {0x38, 0x21, 0x07},
//     {0x38, 0x14, 0x31},
//     {0x38, 0x15, 0x31},
//     {0x38, 0x00, 0x00},
//     {0x38, 0x01, 0x00},
//     {0x38, 0x02, 0x00},
//     {0x38, 0x03, 0xfa},
//     {0x38, 0x04, 0x0a},
//     {0x38, 0x05, 0x3f},
//     {0x38, 0x06, 0x06},
//     {0x38, 0x07, 0xa9},
//     {0x38, 0x08, 0x05},
//     {0x38, 0x09, 0x00},
//     {0x38, 0x0a, 0x02},
//     {0x38, 0x0b, 0xd0},
//     {0x38, 0x0c, 0x07},
//     {0x38, 0x0d, 0x64},
//     {0x38, 0x0e, 0x02},
//     {0x38, 0x0f, 0xe4},
//     {0x38, 0x13, 0x04},
//     {0x36, 0x18, 0x00},
//     {0x36, 0x12, 0x29},
//     {0x37, 0x09, 0x52},
//     {0x37, 0x0c, 0x03},
//     {0x3a, 0x02, 0x02},
//     {0x3a, 0x03, 0xe0},
//     {0x3a, 0x14, 0x02},
//     {0x3a, 0x15, 0xe0},
//     {0x40, 0x04, 0x02},
//     {0x30, 0x02, 0x1c},
//     {0x30, 0x06, 0xc3},
//     {0x47, 0x13, 0x03},
//     {0x44, 0x07, 0x04},
//     {0x46, 0x0b, 0x37},
//     {0x46, 0x0c, 0x20},
//     {0x48, 0x37, 0x16},
//     {0x38, 0x24, 0x04},
//     {0x50, 0x01, 0x83},
//     {0x35, 0x03, 0x00},
//     {0x3b, 0x00, 0x83},
//     {0x3b, 0x00, 0x00}

//     // {0x50, 0x3d, 0x80},
//     // {0x47, 0x41, 0x00}
// };

const RegSetting ov5640_vga_rgb565[] = {
    {0x31, 0x03, 0x11},
    {0x30, 0x08, 0x82},
    {0x30, 0x08, 0x42},
    {0x31, 0x03, 0x03},
    {0x30, 0x17, 0xff},
    {0x30, 0x18, 0xff},
    {0x30, 0x34, 0x1a},
    {0x30, 0x37, 0x13},
    {0x31, 0x08, 0x01},
    {0x36, 0x30, 0x36},

    {0x36, 0x31, 0x0e},
    {0x36, 0x32, 0xe2},
    {0x36, 0x33, 0x12},
    {0x36, 0x21, 0xe0},
    {0x37, 0x04, 0xa0},
    {0x37, 0x03, 0x5a},
    {0x37, 0x15, 0x78},
    {0x37, 0x17, 0x01},
    {0x37, 0x0b, 0x60},
    {0x37, 0x05, 0x1a},

    {0x39, 0x05, 0x02},
    {0x39, 0x06, 0x10},
    {0x39, 0x01, 0x0a},
    {0x37, 0x31, 0x12},
    {0x36, 0x00, 0x08},
    {0x36, 0x01, 0x33},
    {0x30, 0x2d, 0x60},
    {0x36, 0x20, 0x52},
    {0x37, 0x1b, 0x20},
    {0x47, 0x1c, 0x50},

    {0x3a, 0x13, 0x43},
    {0x3a, 0x18, 0x00},
    {0x3a, 0x19, 0xf8},
    {0x36, 0x35, 0x13},
    {0x36, 0x36, 0x03},
    {0x36, 0x34, 0x40},
    {0x36, 0x22, 0x01},
    {0x3c, 0x01, 0x34},
    {0x3c, 0x04, 0x28},
    {0x3c, 0x05, 0x98},

    {0x3c, 0x06, 0x00},
    {0x3c, 0x07, 0x08},
    {0x3c, 0x08, 0x00},
    {0x3c, 0x09, 0x1c},
    {0x3c, 0x0a, 0x9c},
    {0x3c, 0x0b, 0x40},
    {0x38, 0x10, 0x00},
    {0x38, 0x11, 0x10},
    {0x38, 0x12, 0x00},
    {0x37, 0x08, 0x64},

    {0x40, 0x01, 0x02},
    {0x40, 0x05, 0x1a},
    {0x30, 0x00, 0x00},
    {0x30, 0x04, 0xff},
    {0x30, 0x0e, 0x58},
    {0x30, 0x2e, 0x00},
    {0x43, 0x00, 0x61},
    {0x50, 0x1f, 0x01},
    {0x44, 0x0e, 0x00},
    {0x50, 0x00, 0xa7},

    {0x3a, 0x0f, 0x30},
    {0x3a, 0x10, 0x28},
    {0x3a, 0x1b, 0x30},
    {0x3a, 0x1e, 0x26},
    {0x3a, 0x11, 0x60},
    {0x3a, 0x1f, 0x14},
    {0x58, 0x00, 0x23},
    {0x58, 0x01, 0x14},
    {0x58, 0x02, 0x0f},
    {0x58, 0x03, 0x0f},

    {0x58, 0x04, 0x12},
    {0x58, 0x05, 0x26},
    {0x58, 0x06, 0x0c},
    {0x58, 0x07, 0x08},
    {0x58, 0x08, 0x05},
    {0x58, 0x09, 0x05},
    {0x58, 0x0a, 0x08},
    {0x58, 0x0b, 0x0d},
    {0x58, 0x0c, 0x08},
    {0x58, 0x0d, 0x03},

    {0x58, 0x0e, 0x00},
    {0x58, 0x0f, 0x00},
    {0x58, 0x10, 0x03},
    {0x58, 0x11, 0x09},
    {0x58, 0x12, 0x07},
    {0x58, 0x13, 0x03},
    {0x58, 0x14, 0x00},
    {0x58, 0x15, 0x01},
    {0x58, 0x16, 0x03},
    {0x58, 0x17, 0x08},

    {0x58, 0x18, 0x0d},
    {0x58, 0x19, 0x08},
    {0x58, 0x1a, 0x05},
    {0x58, 0x1b, 0x06},
    {0x58, 0x1c, 0x08},
    {0x58, 0x1d, 0x0e},
    {0x58, 0x1e, 0x29},
    {0x58, 0x1f, 0x17},
    {0x58, 0x20, 0x11},
    {0x58, 0x21, 0x11},

    {0x58, 0x22, 0x15},
    {0x58, 0x23, 0x28},
    {0x58, 0x24, 0x46},
    {0x58, 0x25, 0x26},
    {0x58, 0x26, 0x08},
    {0x58, 0x27, 0x26},
    {0x58, 0x28, 0x64},
    {0x58, 0x29, 0x26},
    {0x58, 0x2a, 0x24},
    {0x58, 0x2b, 0x22},

    {0x58, 0x2c, 0x24},
    {0x58, 0x2d, 0x24},
    {0x58, 0x2e, 0x06},
    {0x58, 0x2f, 0x22},
    {0x58, 0x30, 0x40},
    {0x58, 0x31, 0x42},
    {0x58, 0x32, 0x24},
    {0x58, 0x33, 0x26},
    {0x58, 0x34, 0x24},
    {0x58, 0x35, 0x22},

    {0x58, 0x36, 0x22},
    {0x58, 0x37, 0x26},
    {0x58, 0x38, 0x44},
    {0x58, 0x39, 0x24},
    {0x58, 0x3a, 0x26},
    {0x58, 0x3b, 0x28},
    {0x58, 0x3c, 0x42},
    {0x58, 0x3d, 0xce},
    {0x51, 0x80, 0xff},
    {0x51, 0x81, 0xf2},

    {0x51, 0x82, 0x00},
    {0x51, 0x83, 0x14},
    {0x51, 0x84, 0x25},
    {0x51, 0x85, 0x24},
    {0x51, 0x86, 0x09},
    {0x51, 0x87, 0x09},
    {0x51, 0x88, 0x09},
    {0x51, 0x89, 0x75},
    {0x51, 0x8a, 0x54},
    {0x51, 0x8b, 0xe0},

    {0x51, 0x8c, 0xb2},
    {0x51, 0x8d, 0x42},
    {0x51, 0x8e, 0x3d},
    {0x51, 0x8f, 0x56},
    {0x51, 0x90, 0x46},
    {0x51, 0x91, 0xf8},
    {0x51, 0x92, 0x04},
    {0x51, 0x93, 0x70},
    {0x51, 0x94, 0xf0},
    {0x51, 0x95, 0xf0},

    {0x51, 0x96, 0x03},
    {0x51, 0x97, 0x01},
    {0x51, 0x98, 0x04},
    {0x51, 0x99, 0x12},
    {0x51, 0x9a, 0x04},
    {0x51, 0x9b, 0x00},
    {0x51, 0x9c, 0x06},
    {0x51, 0x9d, 0x82},
    {0x51, 0x9e, 0x38},
    {0x54, 0x80, 0x01},

    {0x54, 0x81, 0x08},
    {0x54, 0x82, 0x14},
    {0x54, 0x83, 0x28},
    {0x54, 0x84, 0x51},
    {0x54, 0x85, 0x65},
    {0x54, 0x86, 0x71},
    {0x54, 0x87, 0x7d},
    {0x54, 0x88, 0x87},
    {0x54, 0x89, 0x91},
    {0x54, 0x8a, 0x9a},

    {0x54, 0x8b, 0xaa},
    {0x54, 0x8c, 0xb8},
    {0x54, 0x8d, 0xcd},
    {0x54, 0x8e, 0xdd},
    {0x54, 0x8f, 0xea},
    {0x54, 0x90, 0x1d},
    {0x53, 0x81, 0x1e},
    {0x53, 0x82, 0x5b},
    {0x53, 0x83, 0x08},
    {0x53, 0x84, 0x0a},

    {0x53, 0x85, 0x7e},
    {0x53, 0x86, 0x88},
    {0x53, 0x87, 0x7c},
    {0x53, 0x88, 0x6c},
    {0x53, 0x89, 0x10},
    {0x53, 0x8a, 0x01},
    {0x53, 0x8b, 0x98},
    {0x55, 0x80, 0x06},
    {0x55, 0x83, 0x40},
    {0x55, 0x84, 0x10},

    {0x55, 0x89, 0x10},
    {0x55, 0x8a, 0x00},
    {0x55, 0x8b, 0xf8},
    {0x50, 0x1d, 0x40},
    {0x53, 0x00, 0x08},
    {0x53, 0x01, 0x30},
    {0x53, 0x02, 0x10},
    {0x53, 0x03, 0x00},
    {0x53, 0x04, 0x08},
    {0x53, 0x05, 0x30},

    {0x53, 0x06, 0x08},
    {0x53, 0x07, 0x16},
    {0x53, 0x09, 0x08},
    {0x53, 0x0a, 0x30},
    {0x53, 0x0b, 0x04},
    {0x53, 0x0c, 0x06},
    {0x50, 0x25, 0x00},
    {0x30, 0x08, 0x02},
    {0x30, 0x35, 0x11},
    {0x30, 0x36, 0x46},

    {0x3c, 0x07, 0x08},
    {0x38, 0x20, 0x47},
    {0x38, 0x21, 0x00},
    {0x38, 0x14, 0x31},
    {0x38, 0x15, 0x31},
    {0x38, 0x00, 0x00},
    {0x38, 0x01, 0x00},
    {0x38, 0x02, 0x00},
    {0x38, 0x03, 0x04},
    {0x38, 0x04, 0x0a},

    {0x38, 0x05, 0x3f},
    {0x38, 0x06, 0x07},
    {0x38, 0x07, 0x9b},
    {0x38, 0x08, 0x02}, //水平输出宽度：高四位，默认0x0A
    {0x38, 0x09, 0x80}, //水平输出宽度：低八位，默认0x20
    {0x38, 0x0a, 0x01}, //垂直输出宽度：高三位，默认0x07
    {0x38, 0x0b, 0xe0}, //垂直输出宽度：低八位，默认0x98
    {0x38, 0x0c, 0x07},
    {0x38, 0x0d, 0x68},
    {0x38, 0x0e, 0x03},

    {0x38, 0x0f, 0xd8},
    {0x38, 0x13, 0x06},
    {0x36, 0x18, 0x00},
    {0x36, 0x12, 0x29},
    {0x37, 0x09, 0x52},
    {0x37, 0x0c, 0x03},
    {0x3a, 0x02, 0x17},
    {0x3a, 0x03, 0x10},
    {0x3a, 0x14, 0x17},
    {0x3a, 0x15, 0x10},

    {0x40, 0x04, 0x02},
    {0x30, 0x02, 0x1c},
    {0x30, 0x06, 0xc3},
    {0x47, 0x13, 0x03},
    {0x44, 0x07, 0x04},
    {0x46, 0x0b, 0x35},
    {0x46, 0x0c, 0x22},
    {0x48, 0x37, 0x22},
    {0x38, 0x24, 0x02},
    {0x50, 0x01, 0xa3},

    {0x35, 0x03, 0x00},

    // Color bar
    // {0x50, 0x3d, 0x80},
    // {0x47, 0x41, 0x00}

    //Color square
    // {0x50, 0x3d, 0x82},
    // {0x47, 0x41, 0x00}


    //Brightness -1
    // {0x50, 0x01, 0xFF},
    // {0x55, 0x87, 0x20},
    // {0x55, 0x80, 0x04},
    // {0x55, 0x88, 0x09}

    //Brightness 0
    // {0x50, 0x01, 0xFF},
    // {0x55, 0x87, 0x00},
    // {0x55, 0x80, 0x04},
    // {0x55, 0x88, 0x01}

};

void setup() {
    // Khởi động Wire (I2C)
    Wire.begin(SDA_PIN, SCL_PIN);
    Serial.begin(115200);
    delay(200);
    
    // Có thể chỉnh clock I2C nếu cần (ví dụ 100kHz hoặc 400kHz)
    // Wire.setClock(100000);

    // ===============================================
    // GHI TOÀN BỘ CẤU HÌNH XUỐNG OV5640
    // ===============================================
    // Thay vì viết hàng trăm dòng Wire.begin/end, ta dùng vòng lặp này
    // vừa gọn code, vừa không bị tốn bộ nhớ Flash.
    for (unsigned int i = 0; i < sizeof(ov5640_vga_rgb565) / sizeof(RegSetting); i++) {
        Wire.beginTransmission(OV5640_ADDR);
        
        // Ghi địa chỉ thanh ghi 16-bit (Cao trước, Thấp sau)
        Wire.write(ov5640_vga_rgb565[i].reg_high);
        Wire.write(ov5640_vga_rgb565[i].reg_low);
        
        // Ghi giá trị dữ liệu 8-bit
        Wire.write(ov5640_vga_rgb565[i].val);
        
        Wire.endTransmission();
        
        // Thêm delay nhỏ (1ms) sau mỗi lệnh để đảm bảo OV5640 xử lý kịp
        // (Quan trọng với các lệnh reset hoặc thay đổi PLL)
        delay(1); 
    }
    Serial.println("Initializing OV5640...");
}

void loop() {
    // Code chính của bạn
}




// void setup() {
//   // put your setup code here, to run once:
//   // Start Serial Monitor
//   Serial.begin(115200);
//   delay(200);

//   // Start I2C with custom SDA/SCL pins
//   Wire.begin(SDA_PIN, SCL_PIN);
 
  


//   // 2. Initialization / calibration command
//   Wire.beginTransmission(OV5640_ADDR); Wire.write(0xBE); Wire.write(0x08); Wire.write(0x00); Wire.endTransmission();

//   delay(10);
//   Serial.println("Initializing OV5640...");

// }

// void loop() {
//   // put your main code here, to run repeatedly:

// }
